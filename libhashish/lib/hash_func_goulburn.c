/*
 * The Goulburn Hashing Function / Mayur Patel, as described in
 * http://www.geocities.com/drone115b/Goulburn06.pdf
 *
 * XXX: This file is sperate from hash_func.c. Ugly, but the g_tables
 * really clutter hash_func.c otherwise.
 */

#include "privlibhashish.h"

uint32_t lhi_hash_goulburn(const uint8_t *cp, uint32_t len)
{
	uint32_t h = 0; /* 0: last hash value */
	unsigned i;

	static const uint32_t g_table0[] = {
		4143812366U,2806512183U,4212398656U,393834663U,
		3943187971U,847901099U,3746904015U,2990585247U,
		4243977488U,4075301976U,2737181671U,2429701352U,
		4196558752U,3152011060U,1432515895U,204108242U,
		1180540305U,922583281U,1734842702U,1453807349U,
		507756934U,1553886700U,2005976083U,3346025117U,
		97642817U,2510760451U,4103916440U,3222467334U,
		1312447049U,522841194U,3955607179U,3028936967U,
		2763655970U,3033075496U,1935362065U,512912210U,
		2660383701U,1652921526U,260485165U,141882627U,
		2895806269U,804034013U,1356707616U,3942447612U,
		2875374199U,81028672U,1055595160U,2755907176U,
		2880512448U,1232977841U,3719796487U,2940441976U,
		3739585976U,168332576U,1318372270U,3173546601U,
		3992298512U,3785690335U,3667530757U,3101895251U,
		2789438017U,3213463724U,3067100319U,2554433152U,
		794184286U,2599814956U,1251486151U,4214997752U,
		690900134U,323888098U,1537487787U,1155362310U,
		1826165850U,2358083425U,2957662097U,2514517438U,
		1828367703U,3847031274U,2308450901U,955547506U,
		1037823031U,2922505570U,2544914051U,2572931499U,
		442837508U,1873354958U,2004376537U,25413657U,
		3560636876U,1768043132U,2870782748U,1031556958U,
		715180405U,201079975U,4116730284U,2748714587U,
		1091411202U,33354499U,1931487277U,1039106939U,
		3327011403U,396608379U,3447523131U,301432924U,
		3180185526U,1780290520U,3909968679U,2398211959U,
		3704875308U,66082280U,601805180U,3226323057U,
		3284786200U,2282257088U,700775591U,3528928994U,
		1601645543U,120115228U,568698020U,178214456U,
		41846783U,897656032U,3309570546U,2624714322U,
		2542948622U,1168171675U,2460933760U,93808223U,
		2384991231U,4268721795U,4001720080U,1516739672U,
		4111847489U,810915309U,1238071781U,935043360U,
		2020231594U,37717498U,3603218947U,1534593867U,
		2819275526U,1965883441U,674162751U,128087286U,
		4138356188U,543626850U,1355906380U,3565721429U,
		1142978716U,1614752605U,1624389156U,3363454971U,
		2029311310U,2249603714U,3448236784U,1764058505U,
		2198836711U,3481576182U,3168665556U,3834682664U,
		1979945243U,3456525349U,2721891322U,1099639387U,
		1528675965U,3069012165U,1807951214U,1901014398U,
		2805656341U,3321210152U,2317543573U,1015607418U,
		178584554U,4020226276U,492648819U,97778844U,
		4134244261U,1389599433U,331211243U,3769684011U,
		2036127367U,3174548433U,3241354897U,2570869934U,
		3071842004U,1972073698U,48467379U,1015444026U,
		3126762609U,1104264591U,3096375666U,1380392409U,
		684368280U,1493310388U,2109527660U,3034364089U,
		3168522906U,3042350939U,3696929834U,3410250713U,
		3726870750U,3357455860U,1816295563U,2678332086U,
		26178399U,614899533U,2248041911U,1431155883U,
		1184971826U,3711847923U,2744489682U,168580352U,
		694400736U,2659092308U,811197288U,1093111228U,
		824677015U,2041709752U,1650020171U,2344240270U,
		3773698958U,3393428365U,3498636527U,556541408U,
		1883820721U,3249806350U,3635420446U,1661145756U,
		3087642385U,1620143845U,3852949019U,1054565053U,
		3574021829U,2466085457U,2078148836U,460565767U,
		4097474724U,1381665351U,1652238922U,2200252397U,
		3726797486U,4001080204U,259576503U,567653141U,
		325219513U,1227314237U,3191441965U,1433728871U,
		4198425173U,2908977223U,3757065246U,294312130U,
		4136006097U,3409363054U,2112383431U,1177366649U
	};

	static const uint32_t g_table1[] = {
		826524031U,360568984U,3001046685U,1511935255U,
		1287825396U,3167385669U,1488463483U,4077470910U,
		1360843071U,986771770U,2307292828U,3845679814U,
		1429883439U,1990257475U,4087625806U,1700033651U,
		1388994450U,935547107U,3237786789U,644530675U,
		2274037095U,888755779U,3020158166U,2136355264U,
		2558959443U,1751931693U,2325730565U,3029134627U,
		668542860U,2140243729U,2384660990U,666440934U,
		842610975U,1563602260U,1429103271U,899918690U,
		3441536151U,4078621296U,1527765522U,4191433361U,
		222526771U,309447417U,2035245353U,3730203536U,
		3330019758U,876252573U,2545027471U,453932528U,
		282738293U,1826993794U,1569532013U,543681326U,
		3097574376U,2336551794U,1563241416U,1127019882U,
		3088670038U,2766122176U,3706267663U,1110947226U,
		2608363541U,3166834418U,1310161541U,755904436U,
		2922000163U,3815555181U,1578365408U,3137960721U,
		3254556244U,4287631844U,750375141U,1481489491U,
		1903967768U,3684774106U,765971482U,3225162750U,
		2946561128U,1920278401U,1803486497U,4166913456U,
		1855615192U,1934651772U,1736560291U,2101779280U,
		3560837687U,3004438879U,804667617U,2969326308U,
		3118017313U,3090405800U,566615197U,2451279063U,
		4029572038U,2612593078U,3831703462U,914594646U,
		2873305199U,2860901605U,3296630085U,1273702937U,
		2852911938U,1003268745U,1387783190U,159227777U,
		2211994285U,28095103U,3659848176U,3976935977U,
		3301276082U,2641346573U,651238838U,2264520966U,
		1484747269U,3016251036U,3857206301U,91952846U,
		1662449304U,2028491746U,1613452911U,2409055848U,
		1453868667U,4146146473U,1646176015U,3769580099U,
		3171524988U,2980516679U,828895558U,3384493282U
	};

	for (i=0; i < len; i++) {
		h += g_table0[ cp[i] ];
		h ^= (h << 3) ^ (h >> 29);
		h += g_table1[ h >> 25 ];
		h ^= (h << 14) ^ (h >> 18);
		h += 1783936964UL;
	}
	return h;
}

